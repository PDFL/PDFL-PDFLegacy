name: CD for PDFL chrome extension

on:
  push:
    branches: [main, PL-146-Browser-Extension]
    paths:
      - browser-extension/**

jobs:
  build-and-deploy-extension:
    name: Build and Deploy the PDFL extension
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v2.3.1

      - name: "zip the extension"
        uses: vimtor/action-zip@v1
        with:
          files: browser-extension/*
          dest: extension.zip

      - name: "publish the extension"
        uses: Klemensas/chrome-extension-upload-action@$VERSION
        with:
          refresh-token: ${{ secrets.EXTENSION_REFRESH_TOKEN }}
          client-id: ${{ secrets.EXTENSION_CLIENT_ID }}
          client-secret: ${{ secrets.EXTENSION_CLIENT_SECREWT }}
          file-name: ./extension.zip
          app-id: ${{ secrets.EXTENSION_APP_ID }}
          publish: false
